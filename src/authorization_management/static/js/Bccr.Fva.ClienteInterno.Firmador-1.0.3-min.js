"use strict";var FvaClienteInterno=function(g){this.AsigneElTextoALaVentana=p;this.MuestreLaVentanaModal=H;this.OculteLaVentanaModal=b;this.MuestreElBotonDeAceptar=B;this.OculteElBotonDeAceptar=z;this.MuestreLaAnimacionDeEspera=D;this.OculteLaAnimacionDeEspera=A;this.MuestreElBordeDeError=x;this.RemuevaElBordeDeError=e;this.EnvieLaSolicitud=E;var a=$("<div>",{"class":"fvaBoton"}).html("Aceptar");var s=$("<div>",{"class":"fvaFondoOscuro"});var r=$("<div>",{"class":"fvaVentanaModal"}).css({display:"none"});var F=$("<div>",{"class":"fvaContenidoVentanaModal"});var u=$("<div>",{"class":"fvaMargenDeContenido"});var d=$("<div>",{"class":"fvaContenidoDeCopieCodigo"});var o=$("<div>",{"class":"fvaAcordeon"});var h=$("<div>",{"class":"fvaPanelAcordeon"});var v=$("<span>",{"class":"fvaToolTipText"});var n=$("<div>",{"class":"fvaCodigoConBotonCopiar"});var m=$("<div>",{"class":"fvaLoader"}).append($("<div>"),$("<div>"),$("<div>"));var C=$("<div>",{"class":"fvaElementoOculto"});var w=$("<input/>",{"class":"fvaElementoOculto"});var f=$("<div>",{"class":"fvaMensajeDeCopiado"}).css({display:"none"});var j="Para confirmar la transacci&oacute;n, copie el siguiente c&oacute;digo de verificaci&oacute;n en el Firmador BCCR";var t="&iquest;Qu&eacute; es el Firmador BCCR?";var i='<div class="fvaDescripcionDelFormato"><span class="fvaCodLetra">Letra</span><span class="fvaDescripcionDelFormatoSeparador"> | </span><span>N&uacute;mero</span></div>';var k='<div class="fvaTituloDelResumen">Resumen de la transacci&oacute;n:</div>';var y='<div class="fvaAdvertencia">El c&oacute;digo de verificaci&oacute;n es para su uso exclusivo y personal. No lo facilite por tel&eacute;fono o correo electr&oacute;nico a ninguna persona.</div>';var J=$("<div>",{"class":"fvaResumen"});var q=$("<img>",{src:g.Imagenes.Ayuda,alt:"Ayuda",height:"21",width:"21"});var l=$("<div>",{"class":"fvaContenidoDeTextoCopieElCodigo"});var c=g.UrlConsultaFirma;var G=$("<input/>",{"class":"fvaElBotonDeCopiar",value:"Copiar",type:"button"});if(g.UsoAutenticacion){j="Para confirmar su solicitud de ingreso, copie el siguiente c&oacute;digo de verificaci&oacute;n en el Firmador BCCR";k='<div class="fvaTituloDelResumen">Resumen de la solicitud de ingreso:</div>'}I();function I(){a.bind("click",L);$("body").append(r);$("body").append(s);$("body").append(C);$("body").append(w);$("body").append(f);K();function K(){M();F.append(u,m,a);r.append(F);function M(){$("head").append('<link rel="stylesheet" href="'+g.UrlCSS+'" type="text/css" />')}}function L(){b();g.SolicitudNoRealizada()}}function E(){e();p(g.TextoSolicitando);z();D();H();O();function O(){var R=g.DatosParaSolicitar();$.ajax({url:g.UrlParaSolicitar,type:"POST",dataType:"text json",processData:false,data:R,contentType:false,cache:false,global:false,success:M,error:P})}function M(aj){var ae=aj.FueExitosaLaSolicitud;var R=af(aj.TiempoMaximoDeFirmaEnSegundos);var T=af(aj.TiempoDeEsperaParaConsultarLaFirmaEnSegundos);var Z=aj.CodigoDeVerificacion;var ac=aj.IdDeLaSolicitud;var ag=aj.ResumenDelDocumento;var S=false;if(ae){var ai=V(Z);n.html("").append(ai,G);if(ag===undefined||ag===null){J.html("");k=""}else{J.html(ag)}ah();var ak=W();p(ak);X()}else{K(aj)}function W(){l.html(j);o.append(q,v);h.append(g.ImagenDelFirmador);d.append(l,o);h.css({"max-height":"0px"});o.removeClass("active");v.html(t);o.click(function(){this.classList.toggle("active");if(h[0].style.maxHeight!="0px"){h[0].style.maxHeight="0px";v.html(t)}else{h[0].style.maxHeight=h[0].scrollHeight+"px";v.html("Ocultar")}});G.click(Y);var al=$("<div>").append(d,n,i,k,J,y,h);return al}function Y(){w.val(Z);w.select();var al="";try{var an=document.execCommand("copy");if(an){al="C&oacute;digo de verificaci&oacute;n copiado"}else{al="No se ha podido copiar el c&oacute;digo de verificaci&oacute;n"}}catch(am){al="No se ha podido copiar el c&oacute;digo de verificaci&oacute;n"}f.html(al);if(f[0].style.display!=="block"){f.fadeIn("slow",function(){$(this).delay(1500).fadeOut("slow")})}}function ah(){setTimeout(U,R)}function U(){S=true}function af(al){return 1000*parseInt(al)}function V(ao){var an="<div>";var al;var ap;var aq=ao.length;for(var am=0;am<aq;am++){ap=ao[am];if(ab(ap)){al="<span>"+ap+"</span>"}else{al='<span class="fvaCodLetra">'+ap+"</span>"}an=an+al}return an+"</div>"}function ab(al){return !isNaN(al)}function aa(){var al={IdDeLaSolicitud:ac};$.ajax({url:c,jsonp:"callback",dataType:"jsonp",data:al,global:false,success:ad,error:P})}function X(){setTimeout(aa,T)}function ad(al){if(al.SeRealizo==true){Q(al)}else{if(S==true){P()}else{X()}}}}function Q(R){if(R.FueExitosa==true){L()}else{K(R)}}function K(S){if(S.DebeMostrarElError==true){var R=g.MensajeDeError+'<div class="fvaMargenDeContenido fvaColorMensajeSecundario">'+S.DescripcionDelError+"</div>";N(R)}else{N(g.MensajeDeError)}}function L(){b();g.SolicitudRealizada()}function P(){N(g.MensajeDeError)}function N(R){x();p(R);A();B()}}function p(L){u.html(L);K(L);function K(N){var M=$("<input/>",{type:"text"});M.val(N);C.empty();C.append(M);M.focus()}}function H(){s.css({display:"block"});r.css({display:"block"})}function z(){a.css({display:"none"})}function D(){m.css({display:"block"})}function b(){s.css({display:"none"});r.css({display:"none"})}function A(){m.css({display:"none"})}function B(){a.css({display:"inline-block"})}function e(){F.removeClass("fvaBordeDeError")}function x(){F.addClass("fvaBordeDeError")}};var FvaAutenticador=function(e){e=$.extend({ParaAutenticarse:"",IdDelBotonDeAutenticar:"BotonDeAutenticar",UrlParaSolicitarLaAutenticacion:"",DominioDelSitio:"",MensajeDeError:"Ocurri&oacute; un error al realizar la autenticaci&oacute;n."},e);var r=$("#"+e.IdDelBotonDeAutenticar);var j=$("<img>",{src:e.Imagenes.Autenticador,alt:"Imagen de ayuda del Autenticador"});var i={TextoSolicitando:"Procesando su solicitud de autenticaci&oacute;n...",DominioDelSitio:e.DominioDelSitio,MensajeDeError:e.MensajeDeError,ImagenDelFirmador:j,ObtengaLosDatosParaSolicitarLaAutenticacion:e.ObtengaLosDatosParaSolicitarLaAutenticacion,DatosParaSolicitar:h,SolicitudRealizada:e.AutenticacionRealizada,SolicitudNoRealizada:e.AutenticacionNoRealizada,UrlParaSolicitar:e.UrlParaSolicitarLaAutenticacion,Imagenes:e.Imagenes,UrlConsultaFirma:e.UrlConsultaFirma,UrlCSS:e.UrlCSS,UsoAutenticacion:true};var v="<div class='fvaToolTipIdentificacionTitulo'>Formato de la identificaci&oacute;n</div><ul><li><span>Nacional:</span><span>00-0000-0000</span></li><li><span>DIDI:</span><span>500000000000</span></li><li><span>DIMEX:</span><span>100000000000</span></li></li>";var t="Para autenticarse "+e.ParaAutenticarse+", primero debe ingresar su n&uacute;mero de identificaci&oacute;n:";var u=$("<input>",{type:"text"});var k=$("<div>",{"class":"fvaMensajeErrorIdentificacion fvaMargenDeContenido"});var m=$("<div>",{"class":"fvaBoton"});var a=$("<div>",{"class":"fvaBoton"});var c=$("<div>",{"class":"fvaMargenDeContenido"});var p=$("<div>",{"class":"fvaContenidoParaIdentificacion"});var o=$("<div>",{"class":"fvaPosicionDelToolTipIdentificacion"});var f=$("<div>",{"class":"fvaToolTipIdentificacion"});var b=$("<div>",{"class":"fvaMargenDeContenido"});var l=$("<div>",{"class":"fvaContenidoParaTipoIdentificacion"});var g=$("<div>",{"class":"fvaRadioBoton"});var s=$("<div>",{"class":"fvaRadioBoton"});var d=new FvaClienteInterno(i);r.click(function(){var w=n();d.RemuevaElBordeDeError();d.AsigneElTextoALaVentana(w);d.OculteElBotonDeAceptar();d.OculteLaAnimacionDeEspera();d.MuestreLaVentanaModal();u.focus()});function n(){$(m).unbind();$(u).unbind("keyup");$(a).unbind();$(g).unbind();$(s).unbind();var w=$("<div>");m.html("Autenticar");a.html("Cancelar");g.html("<input type='radio' name='laOpcionNacional' id ='laOpcionNacional' value='laOpcionNacional' checked>Nacional ");s.html("<input type='radio' name='laOpcionExtranjero' id ='laOpcionExtranjero' value='laOpcionExtranjero'>Extranjero");b.html(t);f.html(v);o.append(f);p.append(u,o);l.append(g,s);c.append(m,a);u.val("");k.html("");m.click(function(){q()});u.keyup(function(x){if(x.keyCode===13){q()}if((u.val().length>1)&&(u.val().startsWith("0")==false)&&($("#laOpcionNacional").is(":checked"))){u.val("")}if((u.val().length>1)&&(u.val().startsWith("5")==false)&&(u.val().startsWith("1")==false)&&($("#laOpcionExtranjero").is(":checked"))){u.val("")}if((u.val().length==1)&&(u.val()!="0")&&($("#laOpcionNacional").is(":checked"))){u.val("0"+u.val())}if((u.val().length==1)&&(u.val()!="5")&&(u.val()!="1")&&($("#laOpcionExtranjero").is(":checked"))){u.val("")}});a.click(function(){d.OculteLaVentanaModal()});g.click(function(){$("#laOpcionNacional").prop("checked",true);u.maskCI("00-0000-0000",{reverse:true,placeholder:"00-0000-0000"});u.val("");$("#laOpcionExtranjero").prop("checked",false)});s.click(function(){$("#laOpcionExtranjero").prop("checked",true);u.maskCI("000000000000",{reverse:true,placeholder:"000000000000"});u.val("");$("#laOpcionNacional").prop("checked",false)});w.append(b,p,l,k,c);u.maskCI("00-0000-0000",{reverse:true,placeholder:"00-0000-0000"});return w}function q(){var x=w();if(x){d.EnvieLaSolicitud()}else{d.MuestreElBordeDeError();k.html("El formato de la identificaci&oacute;n es incorrecto.")}function w(){var y=u.val();return FvaValidador.ValideLaIdentificacion(y)}}function h(){var x=e.ObtengaLosDatosParaSolicitarLaAutenticacion();var w=u.val();if(x===undefined){x=new FormData()}x.append("Identificacion",w);return x}};var FvaFirmador=function(c){c=$.extend({IdDelBotonDeFirmar:"BotonDeFirmar",DominioDelSitio:"",MensajeDeError:"Ocurri&oacute; un error al realizar la firma."},c);var f=$("#"+c.IdDelBotonDeFirmar);var a=$("<img>",{src:c.Imagenes.Firma,alt:"Imagen de ayuda del Firmador"});var b={TextoSolicitando:"Procesando su solicitud de firma...",DominioDelSitio:c.DominioDelSitio,MensajeDeError:c.MensajeDeError,ImagenDelFirmador:a,DatosParaSolicitar:d,SolicitudRealizada:c.FirmaRealizada,SolicitudNoRealizada:c.FirmaNoRealizada,UrlParaSolicitar:c.UrlParaSolicitarLaFirma,Imagenes:c.Imagenes,UrlConsultaFirma:c.UrlConsultaFirma,UrlCSS:c.UrlCSS,UsoAutenticacion:false};var e=new FvaClienteInterno(b);f.click(function(){e.EnvieLaSolicitud()});function d(){return c.ObtengaLosDatosParaSolicitarLaFirma()}};var FvaValidador={ValideLaIdentificacion:function(c){var b=/^0[1-9]{1}-\d{4}-\d{4}$/;var e=/^5[0-9]{11}$/;var a=/^1[0-9]{11}$/;var d;if(b.test(c)||e.test(c)||a.test(c)){d=true}else{d=false}return d}};(function(a,c,b){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports==="object"){module.exports=a(require("jquery"))}else{a(c||b)}}}(function(d){var f=function(k,j,i){var m={invalid:[],getCaret:function(){try{var p,s=0,o=k.get(0),n=document.selection,r=o.selectionStart;if(n&&navigator.appVersion.indexOf("MSIE 10")===-1){p=n.createRange();p.moveStart("character",-m.val().length);s=p.text.length}else{if(r||r==="0"){s=r}}return s}catch(q){}},setCaret:function(q){try{if(k.is(":focus")){var n,o=k.get(0);if(o.setSelectionRange){o.setSelectionRange(q,q)}else{n=o.createTextRange();n.collapse(true);n.moveEnd("character",q);n.moveStart("character",q);n.select()}}}catch(p){}},events:function(){k.on("keydown.maskCI",function(n){k.data("maskCI-keycode",n.keyCode||n.which);k.data("maskCI-previus-value",k.val());k.data("maskCI-previus-caret-pos",m.getCaret());m.maskDigitPosMapOld=m.maskCIDigitPosMap}).on(d.jMaskGlobals.useInput?"input.maskCI":"keyup.maskCI",m.behaviour).on("paste.maskCI drop.maskCI",function(){setTimeout(function(){k.keydown().keyup()},100)}).on("change.maskCI",function(){k.data("changed",true)}).on("blur.maskCI",function(){if(h!==m.val()&&!k.data("changed")){k.trigger("change")}k.data("changed",false)}).on("blur.maskCI",function(){h=m.val()}).on("focus.maskCI",function(n){if(i.selectOnFocus===true){d(n.target).select()}}).on("focusout.maskCI",function(){if(i.clearIfNotMatch&&!g.test(m.val())){m.val("")}})},getRegexMask:function(){var p=[],v,u,o,n,t,s;for(var q=0;q<j.length;q++){v=l.translation[j.charAt(q)];if(v){u=v.pattern.toString().replace(/.{1}$|^.{1}/g,"");o=v.optional;n=v.recursive;if(n){p.push(j.charAt(q));t={digit:j.charAt(q),pattern:u}}else{p.push(!o&&!n?u:(u+"?"))}}else{p.push(j.charAt(q).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"))}}s=p.join("");if(t){s=s.replace(new RegExp("("+t.digit+"(.*"+t.digit+")?)"),"($1)?").replace(new RegExp(t.digit,"g"),t.pattern)}return new RegExp(s)},destroyEvents:function(){k.off(["input","keydown","keyup","paste","drop","blur","focusout",""].join(".maskCI "))},val:function(n){var o=k.is("input"),q=o?"val":"text",p;if(arguments.length>0){if(k[q]()!==n){k[q](n)}p=k}else{p=k[q]()}return p},calculateCaretPosition:function(){var x=k.data("maskCI-previus-value")||"",n=m.getMasked(),w=m.getCaret();if(x!==n){var o=k.data("maskCI-previus-caret-pos")||0,y=n.length,t=x.length,u=0,s=0,p=0,v=0,r=0;for(r=w;r<y;r++){if(!m.maskCIDigitPosMap[r]){break}s++}for(r=w-1;r>=0;r--){if(!m.maskCIDigitPosMap[r]){break}u++}for(r=w-1;r>=0;r--){if(m.maskCIDigitPosMap[r]){p++}}for(r=o-1;r>=0;r--){if(m.maskDigitPosMapOld[r]){v++}}if(w>t){w=y}else{if(o>=w&&o!==t){if(!m.maskDigitPosMapOld[w]){var q=w;w-=v-p;w-=u;if(m.maskCIDigitPosMap[w]){w=q}}}else{if(w>o){w+=p-v;w+=s}}}}return w},behaviour:function(q){q=q||window.event;m.invalid=[];var p=k.data("maskCI-keycode");if(d.inArray(p,l.byPassKeys)===-1){var o=m.getMasked(),n=m.getCaret();setTimeout(function(){m.setCaret(m.calculateCaretPosition())},10);m.val(o);m.setCaret(n);return m.callbacks(q)}},getMasked:function(E,I){var G=[],z=I===undefined?m.val():I+"",A=0,p=j.length,u=0,x=z.length,q=1,C="push",D=-1,w=0,r=[],n,H;if(i.reverse){C="unshift";q=-1;n=0;A=p-1;u=x-1;H=function(){return A>-1&&u>-1}}else{n=p-1;H=function(){return A<p&&u<x}}var o;while(H()){var t=j.charAt(A),B=z.charAt(u),s=l.translation[t];if(s){if(B.match(s.pattern)){G[C](B);if(s.recursive){if(D===-1){D=A}else{if(A===n){A=D-q}}if(n===D){A-=q}}A+=q}else{if(B===o){w--;o=undefined}else{if(s.optional){A+=q;u-=q}else{if(s.fallback){G[C](s.fallback);A+=q;u-=q}else{m.invalid.push({p:u,v:B,e:s.pattern})}}}}u+=q}else{if(!E){G[C](t)}if(B===t){r.push(u);u+=q}else{o=t;r.push(u+w);w++}A+=q}}var y=j.charAt(n);if(p===x+1&&!l.translation[y]){G.push(y)}var F=G.join("");m.mapMaskdigitPositions(F,r,x);return F},mapMaskdigitPositions:function(n,p,q){var r=i.reverse?n.length-q:0;m.maskCIDigitPosMap={};for(var o=0;o<p.length;o++){m.maskCIDigitPosMap[p[o]+r]=1}},callbacks:function(o){var q=m.val(),p=q!==h,n=[q,o,k,i],r=function(t,u,s){if(typeof i[t]==="function"&&u){i[t].apply(this,s)}};r("onChange",p===true,n);r("onKeyPress",p===true,n);r("onComplete",q.length===j.length,n);r("onInvalid",m.invalid.length>0,[q,o,k,m.invalid,i])}};k=d(k);var l=this,h=m.val(),g;j=typeof j==="function"?j(m.val(),undefined,k,i):j;l.maskCI=j;l.options=i;l.remove=function(){var n=m.getCaret();m.destroyEvents();m.val(l.getCleanVal());m.setCaret(n);return k};l.getCleanVal=function(){return m.getMasked(true)};l.getMaskedVal=function(n){return m.getMasked(false,n)};l.init=function(p){p=p||false;i=i||{};l.clearIfNotMatch=d.jMaskGlobals.clearIfNotMatch;l.byPassKeys=d.jMaskGlobals.byPassKeys;l.translation=d.extend({},d.jMaskGlobals.translation,i.translation);l=d.extend(true,{},l,i);g=m.getRegexMask();if(p){m.events();m.val(m.getMasked())}else{if(i.placeholder){k.attr("placeholder",i.placeholder)}if(k.data("maskCI")){k.attr("autocomplete","off")}for(var o=0,n=true;o<j.length;o++){var r=l.translation[j.charAt(o)];if(r&&r.recursive){n=false;break}}if(n){k.attr("maxlength",j.length)}m.destroyEvents();m.events();var q=m.getCaret();m.val(m.getMasked());m.setCaret(q)}};l.init(!k.is("input"))};d.maskWatchers={};var e=function(){var g=d(this),h={},j="data-maskCI-",i=g.attr("data-maskCI");if(g.attr(j+"reverse")){h.reverse=true}if(g.attr(j+"clearifnotmatch")){h.clearIfNotMatch=true}if(g.attr(j+"selectonfocus")==="true"){h.selectOnFocus=true}if(a(g,i,h)){return g.data("maskCI",new f(this,i,h))}},a=function(k,h,g){g=g||{};var l=d(k).data("maskCI"),m=JSON.stringify,i=d(k).val()||d(k).text();try{if(typeof h==="function"){h=h(i)}return typeof l!=="object"||m(l.options)!==m(g)||l.maskCI!==h}catch(j){}},c=function(g){var i=document.createElement("div"),h;g="on"+g;h=(g in i);if(!h){i.setAttribute(g,"return;");h=typeof i[g]==="function"}i=null;return h};d.fn.maskCI=function(l,k){k=k||{};var g=this.selector,m=d.jMaskGlobals,i=m.watchInterval,j=k.watchInputs||m.watchInputs,h=function(){if(a(this,l,k)){return d(this).data("maskCI",new f(this,l,k))}};d(this).each(h);if(g&&g!==""&&j){clearInterval(d.maskWatchers[g]);d.maskWatchers[g]=setInterval(function(){d(document).find(g).each(h)},i)}return this};d.fn.masked=function(g){return this.data("maskCI").getMaskedVal(g)};d.fn.unmask=function(){clearInterval(d.maskWatchers[this.selector]);delete d.maskWatchers[this.selector];return this.each(function(){var g=d(this).data("maskCI");if(g){g.remove().removeData("maskCI")}})};d.fn.cleanVal=function(){return this.data("maskCI").getCleanVal()};d.applyDataMask=function(g){g=g||d.jMaskGlobals.maskElements;var h=(g instanceof d)?g:d(g);h.filter(d.jMaskGlobals.dataMaskAttr).each(e)};var b={maskElements:"input,td,span,div",dataMaskAttr:"*[data-maskCI]",dataMask:true,watchInterval:300,watchInputs:true,useInput:!/Chrome\/[2-4][0-9]|SamsungBrowser/.test(window.navigator.userAgent)&&c("input"),watchDataMask:false,byPassKeys:[9,16,17,18,36,37,38,39,40,91],translation:{"0":{pattern:/\d/},"9":{pattern:/\d/,optional:true},"#":{pattern:/\d/,recursive:true},A:{pattern:/[a-zA-Z0-9]/},S:{pattern:/[a-zA-Z]/}}};d.jMaskGlobals=d.jMaskGlobals||{};b=d.jMaskGlobals=d.extend(true,{},b,d.jMaskGlobals);if(b.dataMask){d.applyDataMask()}setInterval(function(){if(d.jMaskGlobals.watchDataMask){d.applyDataMask()}},b.watchInterval)},window.jQuery,window.Zepto));